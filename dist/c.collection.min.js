/** @license
 * protocore-js <https://github.com/dzonzbonz/ProtoCoreJS>
 * Author: Nikola Ivanovic - Dzonz Bonz | MIT License
 * v0.0.1 (2015/06/29 11:50)
 */
;(function(){var a=function(a){return a.Collection={},a.namespace(a.Collection,"C.Collection"),a.Collection.Base=function(){var b=[],c=[],d=!1,e=new a.Enviroment.Object;a.extend(this,e),this.queue=function(d,e,f){f=a.ifDefined(f,!0);var g=this.indexOf(d);if(f&&g!==!1)b.splice(g,1,d),c.splice(g,1,e);else{if(!f&&g!==!1)throw"Unable to queue, Key "+d+" already found at index "+g;g===!1&&(b.push(d),c.push(e))}return this},this.dequeue=function(){if(this.count()==0)throw"Collection is empty";var a={key:b.pop(),val:c.pop()};return a},this.push=function(d,e,f){f=a.ifDefined(f,!0);var g=this.indexOf(d);if(f&&g!==!1)b.splice(g,1,d),c.splice(g,1,e);else{if(!f&&g!==!1)throw"Unable to queue, Key "+d+" already found at index "+g;g===!1&&(b.unshift(d),c.unshift(e))}return this},this.pop=function(){if(this.count()==0)throw"Collection is empty";var a={key:b.shift(),val:c.shift()};return a},this.append=function(a,b,c){return this.queue(a,b,c),this},this.prepend=function(a,b,c){return this.push(a,b,c),this},this.set=function(a,b){return this.queue(a,b,!0),this},this.isset=function(a){return this.indexOf(a)!==!1},this.indexOf=function(a){var c=b.indexOf(a);return c==-1?!1:c},this.unset=function(a){var b=this.indexOf(a);return b!==!1&&this.removeAt(b),this},this.get=function(b,d){var e=null,f=this.indexOf(b);if(f===!1&&!a.isDefined(d))throw"Key not found "+b;return f===!1&&a.isDefined(d)?d:(e=c[f],e)},this.clear=function(){return b=[],c=[],this},this.merge=function(b){a.traverse(b,function(a,b){this.set(a,b)})},this.count=function(){return b.length},this.has=function(){return b.length},this.keys=function(){var a=new Array;for(var c in b)a.push(b[c]);return a},this.insertAt=function(a,d,e){var f=this.indexOf(d);if(f===!1&&this.count()>a&&0<=a)return b.splice(a,0,d),c.splice(a,0,e),this;throw"Unable to insert, Key "+d+" already found at index "+f+", or index out of bounds"},this.itemAt=function(a){var d={};if(a!==!1&&this.count()>a&&0<=a)return d={key:b[a],val:c[a]},d;throw"Unable to find item at index "+a+", index out of bounds"},this.removeAt=function(a){var d={};if(a!==!1&&this.count()>a&&0<=a)return d={key:b[a],val:c[a]},b.splice(a,1),c.splice(a,1),d;throw"Unable to remove item at index "+a+", index out of bounds"},this.remove=function(a){var b=this.count(),c=this.indexOf(a);if(c!==!1&&this.count()>c&&0<=c)throw"Key "+a+" not found.";return this.removeAt(c)},this.cycle=function(a){},this.moveAt=function(a,d){if(d!=a){if(!(a!==!1&&d!==!1&&this.count()>d&&0<=d&&this.count()>a&&0<=a))throw"Unable to move, index out of bounds: (i1="+a+", i2="+d+", n="+this.count()+")";var e=b[a],f=c[a],g=b.length-1;b.splice(a,1),c.splice(a,1),d>=g?(b.push(e),c.push(f)):d<=0?(b.unshift(e),c.unshift(f)):(b.splice(d,0,e),c.splice(d,0,f))}return this},this.move=function(a,b){var c=this.count(),d=this.indexOf(a);if(d===!1)throw"Key "+a+" not found.";var e=d+b;return e%=c,d!=e&&this.moveAt(d,e),this},this.swapAt=function(a,d){if(a!=d){if(!(a!==!1&&d!==!1&&this.count()>a&&0<=a&&this.count()>d&&0<=d))throw"Unable to swap, index out of bounds";var e=c[a];b[a]=b[d],b[d]=e;var f=c[a];c[a]=c[d],c[d]=f}return this},this.swap=function(a,b){var c=this.indexOf(a),d=this.indexOf(b);if(c!=d){if(c===!1||d===!1)throw"Unable to swap, keys not found or equal positions";this.swapAt(c,d)}return this},this.sort=function(c){c=a.ifDefined(c,"asc");var d=c=="asc"?1:-1;if(this.count()>1){var e=b[b.length-1],f=b.length-1,g=b[b.length-1],h=b.length-1,i=h,j=g,k=h,l=b.length;for(var m=0;m<l-1;m++){var n=b[0];if(n>=g&&d>0||n<=g&&d<0)g=n,k=h;else if(n<=e&&d>0||n>=e&&d<0)e=n,k=f-1;else{var o=h,p=f,q=null,r=null,s=0,t=0;j<n&&d>0||j>n&&d<0?p=i:o=i;for(;;){q=p+o>>1,r=b[q],s=n===r?0:n>r?1:-1,t=d*s;if(p===q||o===q||s==0)break;t>0?p=q:t<0&&(o=q)}k=q,t<=0&&k--}this.moveAt(0,k),j=n,i=k,f--}}return this},this.reverse=function(){var a=null,d=null,e=null;for(a=0,d=b.length-1;a<d;a+=1,d-=1)e=b[a],b[a]=b[d],b[d]=e,e=c[a],c[a]=c[d],c[d]=e;return this},this.shuffle=function(){var a=b.length,d,e;while(--a>0)d=~~(Math.random()*(a+1)),e=b[d],b[d]=b[a],b[a]=e,e=c[d],c[d]=c[a],c[a]=e;return this},this.traverse=function(d,e){e=a.ifDefined(e,!1);var f=[],g=this;return a.traverse(b,function(a,b){var h=d.apply(g,[b,c[a]]);e&&f.push({key:b,result:h})}),e?f:this},this.toJSON=function(){var d=e.toJSON.call(this);for(var f in b){var g=b[f],h=c[f];h instanceof a.Enviroment.Object?d[g]=h.toJSON():d[g]=h}return d},this.toJSAN=function(){var d=e.toJSAN.call(this);d[2]=[];for(var f in b){var g=c[f];g instanceof a.Enviroment.Object?d[2].push({key:b[f],val:g.toJSON()}):d[2].push({key:b[f],val:g})}return d},this.serialize=function(){var f=e.serialize.call(this);return f.unique=d,f.collection={},a.traverse(b,function(b,d){f.collection[d]=a.serialize(c[b])}),f},this.unserialize=function(b){return this.clear(),e.unserialize.call(this,b),d=!1,b.unique&&(d=b.unique),b.collection&&a.traverse(b.collection,function(b,c){f.queue(b,a.unserialize(c))}),this};var f=this},a.Collection.Base.prototype=new a.Enviroment.Object,a.Collection.Base.prototype.constructor=a.Collection.Base,a.mode(a.Collection,"Base",a.MODE_LOCKED),a.constructable(a.Collection.Base,"C.Collection.Base"),a.Collection.Array=function(){var b=new a.Collection.Base;a.extend(this,b),this.merge=function(b,c){var d=this;return c=a.ifDefined(c,!1),a.traverse(b,function(b,e){if(!a.isFunction(e))if(!!c||e!=null&&e instanceof a.Collection.Base)if(typeof e=="object"||typeof e=="array"){var f=a.instantiate(a.type(d));d.set(b,f),f.merge(e,c)}else d.set(b,e);else d.set(b,e)}),this},this.traverseInDepth=function(b,c){c=a.ifDefined(c,!1);var d=[{key:"",val:this}],e=[];while(d.length>0){var f=d.pop();f.val instanceof a.Collection.Base&&f.val.traverse(function(a,b){d.push({key:f.key+"/"+a,val:b})});var g=b.apply(this,[f.key==""?"/":f.key,f.val]);c&&e.push({key:f.key==""?"/":f.key,result:g})}return c?e:this},this.sortInDepth=function(b){return this.traverseInDepth(function(c,d){d instanceof a.Collection.Base&&d.sort(b)}),this},this.reverseInDepth=function(){return this.eachInDepth(function(b,c){c instanceof a.Collection.Base&&c.reverse()}),this},this.shuffleInDepth=function(){return this.eachInDepth(function(b,c){c instanceof a.Collection.Base&&c.shuffle()}),this}},a.Collection.Array.prototype=new a.Collection.Base,a.Collection.Array.prototype.constructor=a.Collection.Array,a.mode(a.Collection,"Array",a.MODE_LOCKED),a.constructable(a.Collection.Array,"C.Collection.Array"),a.Collection.Storage=function(){var b=null,c="",d=null,e=new a.Collection.Array;a.extend(this,e,"C.Collection.Storage","C.Collection.Array");var f=function(b){if(b instanceof Array)return b;a.isDefined(b)||(b="/");if(!a.isString(b))throw"Invalid uri value";b.charAt(0)!="/"&&(b="/"+b);var c=b.split("/");return c.splice(0,1),c[0]==""&&c.splice(0,1),c},g=function(a){return"/"+a.join("/")};this.set=function(b,c){var d=f(b);if(d.length==0)this.merge(c);else{var g=d.splice(0,1)[0];if(d.length==0)e.set.call(this,g,c);else{var h=e.isset.call(this,g),i=null;if(!h||!(e.get.call(this,g)instanceof a.Collection.Storage))i=protocor.create(protocor.type(this)),e.set.call(this,g,i);i=e.get.call(this,g),i.set(d,c)}}return this},this.get=function(b){var c=f(b),d=this;if(c.length==0)d=this;else{var g=c.splice(0,1)[0];if(c.length==0)d=e.get.call(this,g);else{var h=e.isset.call(this,g);if(!h||!(e.get.call(this,g)instanceof a.Collection.Storage))throw"Storage path does not exist";d=e.get.call(this,g).get(c)}}return d},this.isset=function(b){var c=f(b),d=!0;if(c.length==0)d=!1;else{var g=c.splice(0,1)[0];d=e.isset.call(this,g),c.length>0&&d&&e.get.call(this,g)instanceof a.Collection.Storage&&(d=e.get.call(this,g).isset(c))}return d},this.unset=function(a){var b=f(a),c=e,d=!0,g=0,h=null;for(var i in b){g++,h=b[i];if(g==b.length)break;if(!c.isset(h)){d=!1;break}c=c.get(h)}return d&&(h==null?this.clear():c.unset(h)),this}},a.Collection.Storage.prototype=new a.Collection.Array,a.Collection.Storage.prototype.constructor=a.Collection.Storage,a.mode(a.Collection,"Storage",a.MODE_LOCKED),a.constructable(a.Collection.Storage,"C.Collection.Storage"),a.Storage};typeof define=="function"&&define.amd?define(["C"],a):typeof module!="undefined"&&module.exports?module.exports=a(require()):window["C.Collection"]=a(C)})();