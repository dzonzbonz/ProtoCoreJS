<!DOCTYPE html>
<html>
    <head>
        <title>ProtoCore Test</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript" src="../dist/c.js"></script>
        <script type="text/javascript" src="../dist/c.enviroment.js"></script>
        <script type="text/javascript" src="../dist/c.http.js"></script>
        <script type="text/javascript" src="../node_modules/zepto-full/zepto.js"></script>
        <!--<script type="text/javascript" src="../dist/thread.js"></script>-->
        <script type="text/javascript" language="javascript">
            function httpRequest() {
                var _request = new C.Http.Request();
                _request.setUrl('file:///var/www/ProtoCoreJS/test/index.html');
                _request.setHeader('Content-Type: text/html');
                _request.onResponse.subscribe(function (e) {
                    console.log(e.data());
                    console.log(e.getHeaders());
                });
                C.Http.Client.request(_request);
            };
            
            $(document).ready(function () {
                
                var CParentClass = function () {

                    this.baseMethod = function () {
                        $("#extend1Message").html('Base method');
                    };

                };

                var CChildClass = function () {

                    var parent = new CParentClass();
                    C.extend(this, parent);

                    this.baseMethod = function () {
                        parent.baseMethod();
                        $("#extend2Message").html('Overrided method');
                    };
                };

                var extendInstance = new CChildClass();
                extendInstance.baseMethod();

                var CObject = new C.Enviroment.Object();
                CObject.data({
                    'value': 1
                });
                
                $('#objectDataSet').html(JSON.stringify({
                    'value': 1
                }));
                
                $('#objectDataGet').html(JSON.stringify(CObject.data()));
                
                var CEvent = new C.Enviroment.EventData({
                    'value': 1
                });
                
                $('#eventDataSet').html(JSON.stringify({
                    'value': 1
                }));
                
//                $('#eventDataGet').html(JSON.stringify(CEvent.data()));
//                for (var i = 1; i < 200; i++) {
//                    Multithread.process(
//                        function Recurse(limit) {
//                            var x = 0;
//                            for (j = 1; j < 1000000; j++) {
//                                x++;
//                            }
//                            
//                            return x;
//                        },
//                        function (r) {
//                            console.log(r);
//                        }
//                    )(100);
//                }
                
                for (var i = 1; i < 10; i++) {
                    (function () {
                        var t = new C.Enviroment.Task(
                            function Recurse(e) {
                                for (var j = 1; j < 1000000; j++) {
                                    if (j % 1000 == 0) {
                                        this.pipe('draw', {
                                            'task': e.task,
                                            'value': j
                                        });
                                        this.sleep(5);
                                    }
                                }
                                
                                return e;
                            }
                        );
                        
                        t.onMessage.subscribe(
                        /**
                         * 
                         * @param {C.Enviroment.EventData} e
                         * @returns {undefined}
                         */
                        function (e) {
                            if (e.data('message') === 'draw') {
                                $("#multiTasking" + e.data('data').task).html(e.data('data').value / 100);
                            }
                        }, t);
                        
//                        t.run({
//                            'task': i
//                        });
                    })();
                }

            });

        </script>
    </head>
    <body>
        <h3>Http Request</h3>
        <div id="httpRequestResponse"></div>
        <button type="button" onclick="httpRequest();">Request</button>
        <h3>Object Data</h3>
        <div id="objectDataSet"></div>
        <div id="objectDataGet"></div>
        <h3>Event Data</h3>
        <div id="eventDataSet"></div>
        <div id="eventDataGet"></div>
        <h3>Multi-threading</h3>
        <div id="multiTasking1"></div>
        <div id="multiTasking2"></div>
        <div id="multiTasking3"></div>
        <div id="multiTasking4"></div>
        <div id="multiTasking5"></div>
        <div id="multiTasking6"></div>
        <div id="multiTasking7"></div>
        <div id="multiTasking8"></div>
        <div id="multiTasking9"></div>
        <button type="button" onclick="test2();">Test</button>
        <h3>Extend</h3>
        <div id="extend1Message"></div>
        <div id="extend2Message"></div>
        <h3>Fork</h3>
        <div id="fork1Message"></div>
        <div id="fork2Message"></div>
        <div id="fork3Message"></div>
    </body>
</html>
