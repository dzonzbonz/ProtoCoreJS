<!DOCTYPE html>
<html>
    <head>
        <title>ProtoCore Test</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript" src="../dist/c.js"></script>
        <script type="text/javascript" src="../dist/c.enviroment.js"></script>
        <script type="text/javascript" src="../dist/c.collection.js"></script>
        <script type="text/javascript" src="../dist/c.http.js"></script>
        <script type="text/javascript" src="../node_modules/zepto-full/zepto.js"></script>
        <!--<script type="text/javascript" src="../dist/thread.js"></script>-->
        <script type="text/javascript" language="javascript">            
            
            function testArray() {
                var array1 = new C.Collection.Array();
                    array1.set('4', 'Some Value 4');
                    array1.set('1', 'Some Value 1');
                    array1.set('6', 'Some Value 6');
                    array1.set('3', 'Some Value 3');
                    array1.set('2', 'Some Value 2');
                    array1.set('8', 'Some Value 8');
                    array1.data('array1', 'array1');
                    
                var array2 = new C.Collection.Array();
                    array2.set('40', 'Some Value 40');
                    array2.set('10', 'Some Value 10');
                    array2.set('60', 'Some Value 60');
                    array2.set('30', 'Some Value 30');
                    array2.set('20', 'Some Value 20');
                    array2.set('80', 'Some Value 80');
                    array2.data('array2', 'array2');
                    
                    $('#array1').html(JSON.stringify(array1.toJSON()));
                    array1.sort();
                    $('#array2').html(JSON.stringify(array1.serialize()));
                    $('#array3').html(JSON.stringify(C.serialize(array1)));
                    
                    $('#array4').html(JSON.stringify(C.serialize(array2)));
            }
            
            function httpRequest() {

                var uriCustom = new C.Http.Uri('http://icard.api:8142/digital-loyalty-card/icard-horisen/customer/1?sample[0][name]=texčćžđšt&sample[0][email]=text&sample[1][name]=text&sample[1][email]=text#apiCall');
                    console.log(uriCustom.toJSON());
                    console.log(uriCustom.build());
                    
                var uriLocation = new C.Http.Uri(location.href);
                    console.log(uriLocation.toJSON());
                    console.log(uriLocation.build());
                    
                var customerGET = new C.Http.Request();
                customerGET.setUrl('http://icard.api/digital-loyalty-card/icard-horisen/customer/1');
                
                customerGET.setMethod(C.Http.Request.prototype.METHOD_GET);
                customerGET.setHeader('Content-Type: application/json');
                
                customerGET.onResponse.subscribe(
                /**
                 * @param {C.Http.Response} e Response evend data
                 * @returns {void}
                 */
                function (e) {
                    if (e.isDone() && e.isSuccess()) {
                        console.log(e.data());
                        console.log(e.getHeaders());
                        console.log(JSON.parse(e.getResponse()));
                    }
                });
                C.Http.Client.request(customerGET);
                
                var shopPurchase = new C.Http.Request();
                    shopPurchase.setUrl('http://icard.api/digital-loyalty-card/icard-horisen/purchase');
                    shopPurchase.setMethod(customerGET.METHOD_POST);
                    shopPurchase.setHeader('Content-Type: application/json');
                    shopPurchase.data({
                        "mobile":"+381638014744",
                        "shop_id":16,
                        "employee_id":8,
                        "receipt_number":"4",
                        "amount": "1000"
                    });
                    shopPurchase.setContent(shopPurchase.encodeContent(shopPurchase.CONTENT_TYPE_JSON));
                    shopPurchase.onResponse.subscribe(
                /**
                 * @param {C.Http.Response} e Response evend data
                 * @returns {void}
                 */
                function (e) {
                    if (e.isDone() && e.isSuccess()) {
                        console.log(e.data());
                        console.log(e.getHeaders());
                        console.log(JSON.parse(e.getResponse()));
                    }
                    else if (e.isDone() && e.isError()) {
                        console.log(e.data());
                        console.log(e.getHeaders());
                        console.log(JSON.parse(e.getResponse()));
                    }
                });
                C.Http.Client.request(shopPurchase);
            };
            
            $(document).ready(function () {
                
                var CParentClass = function () {
                    var parent = new C.Enviroment.Object();
                        C.extend(this, parent);
                    
                    this.baseMethod = function () {
                        $("#extend1Message").html('Base method');
                    };

                    this.parentMethod = function () {
                        $("#extend1Message").html('Base method');
                    };

                };
                
                CParentClass.prototype = new C.Enviroment.Object();
                CParentClass.prototype.constructor = CParentClass;
                C.constructable(CParentClass, 'CParentClass');

                var CChildClass = function () {

                    var parent = new CParentClass();
                        C.extend(this, parent);

                    this.baseMethod = function () {
                        parent.baseMethod();
                        $("#extend2Message").html('Overrided method');
                    };
                    
                    this.childMethod = function () {
                        $("#extend1Message").html('Base method');
                    };
                };

                CChildClass.prototype = new CParentClass();
                CChildClass.prototype.constructor = CChildClass;
                C.constructable(CChildClass, 'CChildClass');

                var extendInstance = new CChildClass();
                var extendInstance2 = new CParentClass();
                    
                    extendInstance.data('array1', 'array1');
                    extendInstance2.data('array2', 'array2');

                    $('#extend1Message').html(JSON.stringify(C.serialize(extendInstance)));
                    $('#extend2Message').html(JSON.stringify(C.serialize(extendInstance2)));
        
//                    extendInstance.baseMethod();



//console.log(extendInstance);
//
//                var CObject = new C.Enviroment.Object();
//                CObject.data({
//                    'value': 1
//                });
//                
//                $('#objectDataSet').html(JSON.stringify({
//                    'value': 1
//                }));
//                
//                $('#objectDataGet').html(JSON.stringify(CObject.data()));
//                
//                var CEvent = new C.Enviroment.EventData({
//                    'value': 1
//                });
//                
//                $('#eventDataSet').html(JSON.stringify({
//                    'value': 1
//                }));
//                console.log();
//                $('#eventDataGet').html(JSON.stringify(CEvent.data()));
//                for (var i = 1; i < 200; i++) {
//                    Multithread.process(
//                        function Recurse(limit) {
//                            var x = 0;
//                            for (j = 1; j < 1000000; j++) {
//                                x++;
//                            }
//                            
//                            return x;
//                        },
//                        function (r) {
//                            console.log(r);
//                        }
//                    )(100);
//                }
                
                for (var i = 1; i < 10; i++) {
                    (function () {
                        var t = new C.Enviroment.Task(
                            function Recurse(e) {
                                for (var j = 1; j < 1000000; j++) {
                                    if (j % 1000 == 0) {
                                        this.pipe('draw', {
                                            'task': e.task,
                                            'value': j
                                        });
                                        this.sleep(5);
                                    }
                                }
                                
                                return e;
                            }
                        );
                        
                        t.onMessage.subscribe(
                        /**
                         * 
                         * @param {C.Enviroment.EventData} e
                         * @returns {undefined}
                         */
                        function (e) {
                            if (e.data('message') === 'draw') {
                                $("#multiTasking" + e.data('data').task).html(e.data('data').value / 100);
                            }
                        }, t);
                        
//                        t.run({
//                            'task': i
//                        });
                    })();
                }

            });

        </script>
    </head>
    <body>
        <h3>Http Request</h3>
        <div id="httpRequestResponse"></div>
        <button type="button" onclick="httpRequest();">Request</button>
        <h3>Object Data</h3>
        <div id="objectDataSet"></div>
        <div id="objectDataGet"></div>
        <h3>Collection Array</h3>
        <div id="array1"></div>
        <div id="array2"></div>
        <div id="array3"></div>
        <div id="array4"></div>
        <button type="button" onclick="testArray();">Test</button>
        <h3>Event Data</h3>
        <div id="eventDataSet"></div>
        <div id="eventDataGet"></div>
        <h3>Multi-threading</h3>
        <div id="multiTasking1"></div>
        <div id="multiTasking2"></div>
        <div id="multiTasking3"></div>
        <div id="multiTasking4"></div>
        <div id="multiTasking5"></div>
        <div id="multiTasking6"></div>
        <div id="multiTasking7"></div>
        <div id="multiTasking8"></div>
        <div id="multiTasking9"></div>
        <button type="button" onclick="test2();">Test</button>
        <h3>Extend</h3>
        <div id="extend1Message"></div>
        <div id="extend2Message"></div>
        <h3>Fork</h3>
        <div id="fork1Message"></div>
        <div id="fork2Message"></div>
        <div id="fork3Message"></div>
    </body>
</html>
